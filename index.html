<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>App de Imóveis - Completo</title>
<style>
body{font-family:'Segoe UI',sans-serif;margin:0;padding:0;background:#f4f6f8;}
input,select{padding:8px 10px;margin:5px 0 15px 0;border-radius:6px;border:1px solid #ccc;font-size:14px;width:100%;box-sizing:border-box;}
#lista{display:grid;grid-template-columns:1fr;gap:16px;margin-bottom:30px;padding:0 10px;}
@media(min-width:600px){#lista{grid-template-columns:repeat(2,1fr);}}
@media(min-width:900px){#lista{grid-template-columns:repeat(3,1fr);}}
.card{border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,0.1);overflow:hidden;background:#fff;transition:transform .2s,box-shadow .2s;display:flex;flex-direction:column;position:relative;}
.card:hover{transform:translateY(-4px);box-shadow:0 8px 20px rgba(0,0,0,0.2);}
.card img{width:100%;height:350px;object-fit:cover;}
.card-body{padding:12px;flex:1;display:flex;flex-direction:column;justify-content:space-between;}
.card h3{margin:0;font-size:16px;color:#1a1a1a;}
.card p{margin:4px 0;color:#555;font-size:13px;}
.card p.preco{font-weight:bold;color:#2d89ef;font-size:15px;}
.btn-detalhes, .modal-content .btn-whatsapp{display:block;margin:10px auto;background:#25D366;color:#fff;text-align:center;padding:8px 20px;border-radius:6px;font-weight:bold;text-decoration:none;cursor:pointer;font-size:14px;transition: transform .25s ease;animation:pulse 2s infinite;}
.btn-detalhes:hover{transform: scale(1.08);}
@keyframes pulse{0%{transform:scale(1);}50%{transform:scale(1.05);}100%{transform:scale(1);}}
.modal{display:none;position:fixed;z-index:9999;left:0;top:0;width:100%;height:100%;background-color: rgba(0,0,0,0.7);overflow-x:hidden;opacity:0;transition: opacity .35s ease;}
.modal.show{display:block;opacity:1;}
.modal-content{background:#fff;padding:15px;border-radius:12px;width:95%;max-width:400px;max-height:90vh;overflow-y:auto;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%) scale(.96);box-sizing:border-box;opacity:0;transition: all .35s ease;}
.modal.show .modal-content{transform:translate(-50%,-50%) scale(1);opacity:1;}
.modal-content img{width:100%;height:auto;max-height:320px;object-fit:contain;background:#f4f4f4;border-radius:8px;margin-bottom:10px;cursor:pointer;transition: transform .3s;}
.modal-content img.zoomed{transform: scale(2);cursor:move;}
.modal-content img:hover:not(.zoomed){transform: scale(1.03);}
.modal-content .nav-arrow{position:absolute;top:50%;transform: translateY(-50%);font-size:22px;color:#fff;background:rgba(0,0,0,0.3);padding:4px 8px;border-radius:50%;cursor:pointer;user-select:none;z-index:5;}
.modal-content .nav-left{left:8px;} .modal-content .nav-right{right:8px;}
.miniaturas{display:flex;justify-content:center;gap:6px;margin-top:8px;flex-wrap:wrap;}
.miniaturas img{width:50px;height:50px;object-fit:cover;border-radius:6px;cursor:pointer;border:2px solid transparent;transition:border .2s;}
.miniaturas img.selected{border-color:#2d89ef;}
.close{color:#aaa;position:absolute;top:8px;right:15px;font-size:24px;font-weight:bold;cursor:pointer;}
.close:hover{color:#000;}
.tab{display:inline-block;padding:6px 12px;cursor:pointer;border-radius:6px;background:#eee;margin-right:5px;font-weight:bold;font-size:14px;}
.tab.active{background:#2d89ef;color:#fff;}
.ordenacao-select{padding:6px 10px;border-radius:6px;border:1px solid #ccc;font-size:14px;margin-bottom:10px;width:100%;box-sizing:border-box;}
#destaques-container{position:relative;margin-top:15px;}
#destaques{display:flex;gap:12px;overflow-x:auto;scroll-behavior:smooth;padding:0 40px;}
#destaques .destaque-card{min-width:160px;flex:0 0 auto;border-radius:12px;overflow:hidden;background:#fff;box-shadow:0 4px 12px rgba(0,0,0,0.1);cursor:pointer;transition:transform .2s,box-shadow .2s;text-align:center;}
#destaques .destaque-card:hover{transform:translateY(-3px);box-shadow:0 6px 18px rgba(0,0,0,0.2);}
#destaques .destaque-card img{width:100%;height:auto;max-height:250px;object-fit:contain;background:#f4f4f4;}
#destaques .destaque-card p{padding:6px;margin:0;font-size:12px;font-weight:bold;color:#2d89ef;}
#destaques-container .destaque-left,#destaques-container .destaque-right{position:absolute;top:50%;transform:translateY(-50%);font-size:28px;color:#fff;background:rgba(0,0,0,0.4);padding:6px 12px;border-radius:50%;cursor:pointer;z-index:10;}
#destaques-container .destaque-left{left:5px;} #destaques-container .destaque-right{right:5px;}
#whatsapp-flutuante{position:fixed;bottom:15px;right:15px;width:60px;height:60px;z-index:9999;cursor:pointer;animation:pulse 2s infinite;}
#whatsapp-flutuante img{width:100%;height:100%;border-radius:50%;}
@media(max-width:480px){.modal-content .nav-arrow,.card h3{font-size:14px;}.card p,.card p.preco{font-size:12px;}}
</style>
</head>
<body>

<div id="destaques-container">
  <span class="nav-arrow destaque-left">&#10094;</span>
  <div id="destaques"></div>
  <span class="nav-arrow destaque-right">&#10095;</span>
</div>

<div id="imoveis-app">
  <div id="tabs-container"></div>
  <div id="filtros-container"></div>
  <div id="ordenacao-container"></div>
  <div id="lista"></div>

  <div id="detalhesModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <div id="modal-body"></div>
    </div>
  </div>
</div>

<a id="whatsapp-flutuante" href="https://api.whatsapp.com/send?phone=5512992468636" target="_blank" aria-label="WhatsApp">
  <img src="https://cdn-icons-png.flaticon.com/512/733/733585.png" alt="WhatsApp">
</a>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<script>
const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vR4c2-Gi7ANJkDp7exGoOw17T8Sh-5Gw7Ioi8ZgSCT4skcLLwULZuHhmUnQvw4Ke7dmG4VWuHDbRCuV/pub?gid=506124050&single=true&output=csv";
const whatsappNumber = "5512992468636";

/* ==================== Modal ==================== */
class ModalImovel {
  constructor(id){
    this.modal=document.getElementById(id);
    this.body=this.modal.querySelector('#modal-body');
    this.close=this.modal.querySelector('.close');
    this.autoPlayInterval=null;
    this.close.onclick=()=>this.fechar();
    window.addEventListener('keydown', e=>{if(e.key==='Escape') this.fechar();});
    window.onclick=e=>{if(e.target==this.modal) this.fechar();};
  }
  abrir(imovel){
    clearInterval(this.autoPlayInterval);
    const imgs=(imovel.imagens||'').split(' ').filter(i=>i);
    let idxImg=0;
    this.body.innerHTML=`
      <h2>${imovel.titulo}</h2>
      <p><b>Código:</b> ${imovel.ref||''}</p>
      <p class="preco">R$ ${Number(imovel.preco).toLocaleString()} | ${imovel.cidade} | ${imovel.tipo||''} | ${imovel.operacao||''}</p>
      <div style="position:relative; overflow:hidden;">
        <img id="main-img" data-src="${imgs[0]||'https://via.placeholder.com/400x250'}" loading="lazy">
        <span class="nav-arrow nav-left">&#10094;</span>
        <span class="nav-arrow nav-right">&#10095;</span>
      </div>
      <div class="miniaturas">${imgs.map((s,i)=>`<img data-src="${s}" class="${i===0?'selected':''}" loading="lazy">`).join('')}</div>
      <a class="btn-whatsapp" href="https://api.whatsapp.com/send?phone=${whatsappNumber}&text=Ol%C3%A1,%20interessei-me%20no%20im%C3%B3vel%20${encodeURIComponent(imovel.titulo)}" target="_blank">WhatsApp</a>
    `;
    const main=this.body.querySelector('#main-img'); main.src=main.dataset.src;
    const mini=this.body.querySelectorAll('.miniaturas img'); mini.forEach(m=>m.src=m.dataset.src);
    const left=this.body.querySelector('.nav-left'); const right=this.body.querySelector('.nav-right');
    let isZoomed=false, translateX=0, translateY=0, dragging=false, startX=0, startY=0;
    const update=i=>{ idxImg=(i+imgs.length)%imgs.length; main.src=imgs[idxImg]; mini.forEach((m,j)=>m.classList.toggle('selected',idxImg===j)); isZoomed=false; main.classList.remove('zoomed'); main.style.transform='scale(1) translate(0,0)'; translateX=0; translateY=0; };
    left.onclick=()=>update(idxImg-1); right.onclick=()=>update(idxImg+1);
    mini.forEach((m,i)=>m.onclick=()=>update(i));
    main.onclick=e=>{isZoomed=!isZoomed; main.classList.toggle('zoomed',isZoomed); main.style.cursor=isZoomed?'move':'zoom-in'; main.style.transform=isZoomed?'scale(2)':'scale(1)';};
    main.addEventListener('mousedown', e=>{if(isZoomed){dragging=true;startX=e.clientX-translateX;startY=e.clientY-translateY;main.style.cursor='grabbing';}});
    window.addEventListener('mousemove', e=>{if(dragging){translateX=e.clientX-startX;translateY=e.clientY-startY;main.style.transform=`scale(2) translate(${translateX}px,${translateY}px)`;}});
    window.addEventListener('mouseup', ()=>{dragging=false;if(isZoomed) main.style.cursor='move';});
    this.modal.classList.add('show');
  }
  fechar(){ this.modal.classList.remove('show'); }
}

/* ==================== Lista ==================== */
class ListaImoveis{
  constructor(id, modal){ this.lista=document.getElementById(id); this.modal=modal; this.filteredData=[]; }
  render(dados,filtro={},tab=""){
    const source=Array.isArray(dados)?dados:[]; this.lista.innerHTML=''; 
    this.filteredData=source.filter(i=>{
      if(tab && i.operacao!==tab) return false;
      if(filtro.busca && !(`${i.titulo} ${i.descricao} ${i.bairro||''} ${i.ref||''}`.toLowerCase().includes(filtro.busca.toLowerCase()))) return false;
      if(filtro.cidade && i.cidade!==filtro.cidade) return false;
      if(filtro.tipo && i.tipo!==filtro.tipo) return false;
      if(filtro.aceita_pet && i.aceita_pet!==filtro.aceita_pet) return false;
      if(filtro.cond_incluso && i.cond_incluso!==filtro.cond_incluso) return false;
      if(filtro.precoMin && Number(i.preco)<Number(filtro.precoMin)) return false;
      if(filtro.precoMax && Number(i.preco)>Number(filtro.precoMax)) return false;
      return true;
    });
    this.filteredData.forEach(i=>{
      const c=document.createElement('div'); c.className='card';
      const imgs=(i.imagens||'').split(' ').filter(s=>s);
      c.innerHTML=`<img data-src="${imgs[0]||'https://via.placeholder.com/400x250'}" loading="lazy">
                     <div class="card-body">
                       <h3>${i.titulo||''}</h3>
                       <p class="preco">R$ ${Number(i.preco||0).toLocaleString()}</p>
                       <p>${i.cidade||''} | ${i.tipo||''}</p>
                       <button class="btn-detalhes">Detalhes</button>
                     </div>`;
      c.querySelector('.btn-detalhes').onclick=()=>this.modal.abrir(i);
      c.querySelector('img').src=c.querySelector('img').dataset.src;
      this.lista.appendChild(c);
    });
  }
}

/* ==================== Filtros ==================== */
class FiltroImoveis{
  constructor(id,dados,lista){
    this.c=document.getElementById(id); this.dados=dados; this.lista=lista;
    const cidades=[...new Set(dados.map(i=>i.cidade))]; const tipos=[...new Set(dados.map(i=>i.tipo))];
    this.c.innerHTML=`<input id="busca" placeholder="Título, descrição, bairro ou código">
      <select id="filtroCidade"><option value="">Cidades</option>${cidades.map(c=>`<option value="${c}">${c}</option>`).join('')}</select>
      <select id="filtroTipo"><option value="">Tipos de Imóveis</option>${tipos.map(c=>`<option value="${c}">${c}</option>`).join('')}</select>
      <select id="filtroPet"><option value="">Aceita Pet?</option><option value="Sim">Sim</option><option value="Não">Não</option></select>
      <select id="filtroCond"><option value="">Condomínio Incluso?</option><option value="Sim">Sim</option><option value="Não">Não</option></select>
      <input id="precoMin" type="number" placeholder="Preço Mínimo">
      <input id="precoMax" type="number" placeholder="Preço Máximo">`;
    ['busca','filtroCidade','filtroTipo','filtroPet','filtroCond','precoMin','precoMax'].forEach(id=>{
      this.c.querySelector('#'+id).addEventListener('input',()=>this.aplicar());
    });
  }
  aplicar(){
    const filtro={
      busca:this.c.querySelector('#busca').value,
      cidade:this.c.querySelector('#filtroCidade').value,
      tipo:this.c.querySelector('#filtroTipo').value,
      aceita_pet:this.c.querySelector('#filtroPet').value,
      cond_incluso:this.c.querySelector('#filtroCond').value,
      precoMin:this.c.querySelector('#precoMin').value,
      precoMax:this.c.querySelector('#precoMax').value
    };
    this.lista.render(this.dados,filtro,document.querySelector('.tab.active')?.textContent||'');
  }
}

/* ==================== Tabs ==================== */
class TabsImoveis{
  constructor(id,dados,lista,filtro){
    this.c=document.getElementById(id); this.dados=dados; this.lista=lista; this.filtro=filtro;
    const ops=[...new Set(dados.map(i=>i.operacao))]; 
    this.c.innerHTML=ops.map(o=>`<span class="tab">${o}</span>`).join('');
    this.c.querySelectorAll('.tab').forEach(tab=>{
      tab.onclick=()=>{
        this.c.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
        tab.classList.add('active');
        this.filtro.aplicar();
      };
    });
    if(this.c.querySelector('.tab')) this.c.querySelector('.tab').classList.add('active');
  }
}

/* ==================== Ordenação ==================== */
class OrdenacaoImoveis{
  constructor(id,lista,filtro,dados){
    this.c=document.getElementById(id); this.lista=lista; this.filtro=filtro; this.dados=dados;
    this.c.innerHTML=`<select class="ordenacao-select">
      <option value="">Ordenar</option>
      <option value="preco-asc">Preço Crescente</option>
      <option value="preco-desc">Preço Decrescente</option>
      <option value="area-asc">Área Crescente</option>
      <option value="area-desc">Área Decrescente</option>
    </select>`;
    this.c.querySelector('select').addEventListener('change', e=>{
      const val=e.target.value;
      if(val==='preco-asc') this.dados.sort((a,b)=>Number(a.preco)-Number(b.preco));
      else if(val==='preco-desc') this.dados.sort((a,b)=>Number(b.preco)-Number(a.preco));
      else if(val==='area-asc') this.dados.sort((a,b)=>Number(a.area)-Number(b.area));
      else if(val==='area-desc') this.dados.sort((a,b)=>Number(b.area)-Number(a.area));
      this.filtro.aplicar();
    });
  }
}

/* ==================== Destaques ==================== */
class Destaques{
  constructor(id,dados,modal){
    this.c=document.getElementById(id); this.dados=dados; this.modal=modal;
    this.c.innerHTML=dados.map(i=>`<div class="destaque-card"><img data-src="${(i.imagens||'').split(' ')[0]||'https://via.placeholder.com/200x150'}" loading="lazy"><p>${i.titulo}</p></div>`).join('');
    const cards=this.c.querySelectorAll('.destaque-card'); cards.forEach((card,i)=>{ card.querySelector('img').src=card.querySelector('img').dataset.src; card.onclick=()=>modal.abrir(dados[i]);});
    let scrollPos=0;
    const left=this.c.parentElement.querySelector('.destaque-left');
    const right=this.c.parentElement.querySelector('.destaque-right');
    left.onclick=()=>{scrollPos-=200; this.c.scrollTo({left:scrollPos,behavior:'smooth'});};
    right.onclick=()=>{scrollPos+=200; this.c.scrollTo({left:scrollPos,behavior:'smooth'});};
  }
}

/* ==================== Carregar CSV ==================== */
Papa.parse(csvUrl,{download:true,header:true,complete:res=>{
  const allData=res.data.slice(1).map(i=>{
    i.ref=i.ref||''; i.aceita_pet=i.aceita_pet==='Sim'?'Sim':'Não';
    i.cond_incluso=i.cond_incluso==='Sim'?'Sim':'Não';
    i.garagem=i.garagem||'0'; i.titulo=i.titulo||''; i.descricao=i.descricao||'';
    i.tipo=i.tipo||''; i.operacao=i.operacao||''; i.cidade=i.cidade||'';
    i.preco=i.preco||'0'; i.condominio=i.condominio||'0'; i.iptu=i.iptu||'0';
    i.area=i.area||'0'; i.banheiros=i.banheiros||'0'; i.quartos=i.quartos||'0';
    i.imagens=i.imagens||''; return i;
  });
  const modal=new ModalImovel('detalhesModal');
  const lista=new ListaImoveis('lista',modal);
  const filtro=new FiltroImoveis('filtros-container',allData,lista);
  const tabs=new TabsImoveis('tabs-container',allData,lista,filtro);
  const ordenacao=new OrdenacaoImoveis('ordenacao-container',lista,filtro,allData);
  const destaques=new Destaques('destaques',allData,modal);
  filtro.aplicar();
}});
</script>
</body>
</html>
